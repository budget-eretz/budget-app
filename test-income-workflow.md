# תסריט בדיקה ידנית למערכת אישור הכנסות

## מה השתנה?
כעת רק גזבר מעגלי יכול לאשר הכנסות. כל הכנסה חדשה מתחילה בסטטוס 'pending' וצריכה אישור מגזבר מעגלי.

## תסריט הבדיקה

### 1. הכנת סביבה
- ✅ Docker רץ
- ✅ Migration 032 רץ בהצלחה
- ✅ Backend מקומפל ללא שגיאות
- ✅ Frontend נבנה בהצלחה

### 2. כניסה למערכת
1. פתח דפדפן: http://localhost:3456
2. התחבר כ**חבר רגיל** (לא גזבר)

### 3. בדיקה: יצירת הכנסה כחבר רגיל
1. עבור לדף "הכנסות"
2. לחץ על "הוסף הכנסה חדשה"
3. **בדוק:** האם יש שדה בחירת סטטוס? ❌ **לא אמור להיות!**
4. מלא את השדות:
   - סכום: 1000
   - תאריך: היום
   - תיאור: "בדיקה - הכנסה לאישור"
   - מקור: בחר חבר או "מקור בדיקה"
5. שמור
6. **בדוק:** ההכנסה מופיעה עם סטטוס "ממתין לאישור" (צהוב) ✅
7. **בדוק:** יש כפתור "ערוך" רק להכנסות pending ✅

### 4. בדיקה: ניסיון עריכה
1. לחץ על "ערוך" בהכנסה שיצרת
2. **בדוק:** האם יש שדה בחירת סטטוס? ❌ **לא אמור להיות!**
3. שנה את הסכום ל-1500
4. שמור
5. **בדוק:** השינוי נשמר ✅

### 5. כניסה כגזבר מעגלי
1. התנתק
2. התחבר כ**גזבר מעגלי**

### 6. בדיקה: אישור הכנסה
1. עבור לדף "הכנסות"
2. סנן לפי סטטוס "ממתין לאישור" (אופציונלי)
3. **בדוק:** יש כפתורים "✓ אשר" ו-"✗ דחה" בהכנסות pending ✅
4. לחץ על "✓ אשר" בהכנסה שיצרת
5. **בדוק:** הסטטוס השתנה ל-"אושר" (ירוק) ✅
6. **בדוק:** הכפתורים "אשר" ו-"דחה" נעלמו ✅
7. **בדוק:** לא ניתן לערוך את ההכנסה יותר ✅

### 7. בדיקה: דחיית הכנסה
1. צור הכנסה חדשה כחבר רגיל (או התחבר כחבר רגיל ויצור)
2. חזור לגזבר מעגלי
3. לחץ על "✗ דחה" בהכנסה החדשה
4. **בדוק:** מופיע prompt להזנת הערות ✅
5. הזן הערה: "נדחתה מכיוון שזו בדיקה"
6. אשר
7. **בדוק:** הסטטוס השתנה ל-"נדחה" (אדום) ✅
8. **בדוק:** לא ניתן לערוך את ההכנסה יותר ✅

### 8. בדיקה: השפעה על תקציב
1. עבור לעמוד התקציבים
2. בדוק את תקציב "הכנסות"
3. **בדוק:** רק הכנסות מאושרות משפיעות על הסכום ✅
4. הכנסות pending/rejected לא משפיעות ✅

### 9. בדיקות נוספות
- [ ] סינון לפי סטטוס עובד (pending/confirmed/rejected)
- [ ] מיון לפי סטטוס עובד
- [ ] תצוגת הכנסות נדחות מראה את ההערות
- [ ] לא ניתן לאשר הכנסה שכבר אושרה/נדחתה

## תוצאות צפויות

### Backend API
- ✅ `POST /api/incomes` - יוצר הכנסה עם status='pending' תמיד
- ✅ `PATCH /api/incomes/:id` - מאפשר עדכון רק אם status='pending'
- ✅ `POST /api/incomes/:id/confirm` - רק גזבר מעגלי, רק pending
- ✅ `POST /api/incomes/:id/reject` - רק גזבר מעגלי, רק pending

### Frontend UI
- ✅ טופס הכנסה חדשה: אין שדה סטטוס
- ✅ טופס עריכת הכנסה: אין שדה סטטוס
- ✅ טבלת הכנסות: מראה 3 סטטוסים (pending/confirmed/rejected)
- ✅ כפתורי אישור/דחייה: רק לגזבר מעגלי, רק ל-pending
- ✅ כפתור עריכה: רק ל-pending

### Database
- ✅ טבלת incomes תומכת ב-3 סטטוסים
- ✅ עמודת notes קיימת
- ✅ אינדקסים ל-pending ו-rejected

## בעיות אפשריות ופתרונות

### בעיה: לא רואה כפתורי אישור/דחייה
**פתרון:** וודא שהתחברת כגזבר מעגלי (user.isCircleTreasurer = true)

### בעיה: טופס עדיין מראה בחירת סטטוס
**פתרון:** נקה את ה-cache של הדפדפן (Ctrl+Shift+R)

### בעיה: שגיאה "status must be one of..."
**פתרון:** הרץ את ה-migration: `docker-compose exec backend npm run migrate`

### בעיה: הכנסות ישנות לא עובדות
**פתרון:** הכנסות ישנות נשארו עם status='confirmed', זה תקין
