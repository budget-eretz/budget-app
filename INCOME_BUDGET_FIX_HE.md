# תיקון: תקציב ייעודי להכנסות

## מה הבעיה שתוקנה?

בעבר, כשהוספת הכנסה חדשה, היית צריך לבחור לאיזה תקציב היא נכנסת. זה יצר בעיות:
- הכנסות נכנסו לתקציבים לא קשורים (למשל "בעלי חיים")
- קשה היה לעקוב אחרי סך כל ההכנסות
- לא היה ברור כמה כסף נכנס למעגל

## מה השתנה?

### 1. תקציב הכנסות אוטומטי
המערכת עכשיו יוצרת ומנהלת אוטומטית תקציב בשם **"הכנסות"**:
- כל הכנסה חדשה נכנסת אוטומטית לתקציב הזה
- לא צריך יותר לבחור תקציב בטופס ההכנסה
- סכום התקציב מתעדכן אוטומטית

### 2. העברת הכנסות קיימות
Migration אוטומטי מעביר את כל ההכנסות הקיימות:
- מזהה הכנסות שנכנסו לתקציבים אחרים
- מעביר אותן לתקציב "הכנסות"
- מעדכן את סכום התקציב

### 3. ממשק פשוט יותר
בטופס הוספת הכנסה:
- ❌ אין יותר שדה "בחר תקציב"
- ✅ רק השדות הרלוונטיים: סכום, תאריך, מקור, תיאור

## איך זה עובד?

### הוספת הכנסה חדשה
1. נכנסים לדף "הכנסות"
2. לוחצים "הוסף הכנסה"
3. ממלאים את הפרטים (בלי לבחור תקציב!)
4. המערכת אוטומטית:
   - מוצאת/יוצרת את תקציב ההכנסות
   - מוסיפה את ההכנסה לתקציב
   - מעדכנת את סכום התקציב

### עדכון הכנסה
כשמעדכנים סכום הכנסה:
- התקציב מתעדכן אוטומטית
- ההפרש מתווסף או מופחת מסכום התקציב

### מחיקת הכנסה
כשמוחקים הכנסה:
- הסכום מופחת אוטומטית מתקציב ההכנסות

## איך להריץ את התיקון?

### אם המערכת רצה ב-Docker:
```bash
docker-compose exec backend npm run migrate up
```

### אם המערכת רצה ישירות:
```bash
cd backend
npm run migrate up
```

### בדיקה שהכל עבד:
```bash
cd backend
npm run check:income-budget
```

הפקודה תציג:
- ✅ האם תקציב הכנסות קיים
- 📊 כמה הכנסות יש בתקציב
- ⚠️ האם יש הכנסות בתקציבים אחרים (לא אמור להיות!)

## שאלות נפוצות

**ש: מה קורה להכנסות שכבר היו במערכת?**  
ת: ה-migration מעביר אותן אוטומטית לתקציב הכנסות. שום דבר לא נמחק.

**ש: האם אפשר להריץ את ה-migration כמה פעמים?**  
ת: כן! ה-migration בטוח - הוא בודק אם תקציב הכנסות כבר קיים ולא יוצר כפילויות.

**ש: מה קורה אם אין משתמשים במערכת?**  
ת: ה-migration יוצר את התקציב עם המשתמש הראשון שהוא מוצא. אם אין משתמשים, הוא ידלג על היצירה.

**ש: האם Expected Income (הכנסות צפויות) גם נכנס לתקציב הכנסות?**  
ת: לא. Expected Income נשאר מקושר לתקציבים שונים כי זה תכנון עתידי. רק Actual Income (הכנסות בפועל) נכנס אוטומטית לתקציב הכנסות.

**ש: איך אני רואה את תקציב ההכנסות?**  
ת: תקציב ההכנסות מופיע ברשימת התקציבים כמו כל תקציב אחר, עם הסכום המעודכן של כל ההכנסות.

## תמיכה

אם יש בעיה או שאלה:
1. הרץ את `npm run check:income-budget` לבדיקה
2. בדוק את ה-logs של ה-migration
3. פתח issue בגיטהאב עם הפרטים
