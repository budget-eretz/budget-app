# הפרדת תכנון מביצוע - Planning vs Execution Separation

## סקירה כללית

המערכת מפרידה בין **תכנון** לבין **ביצוע בפועל** כדי לאפשר ניתוח תקציבי מדויק יותר.

## הבעיה שנפתרה

בעבר, תכנוני הוצאות השפיעו על חישוב התקציב הזמין:
```
יתרה = הוקצה - הוצא - מתוכנן
```

זה יצר בעיות:
- תכנונים לא תמיד מתממשים בדיוק כפי שתוכננו
- התקציב הזמין היה מוטה למטה באופן מלאכותי
- קשה היה להבין את הסטייה בין תכנון לביצוע

## הפתרון החדש

### שלושה מסלולים מקבילים:

#### 1. ביצוע בפועל (Actual Execution)
מה קרה בפועל:
```
הוקצה: 100 ₪
יצא: 70 ₪
נשאר: 30 ₪
```

#### 2. תכנון (Planning)
מה תוכנן:
```
הוקצה: 100 ₪
מתוכנן: 50 ₪
לא מתוכנן (buffer): 50 ₪
```

#### 3. תכנון מול ביצוע (Variance)
השוואה:
```
תוכנן: 50 ₪
בוצע: 70 ₪
סטייה: +20 ₪ (140%)
אינדיקטור: ⚠️ חריגה
```

## יתרונות

1. **תקציב זמין מדויק**: היתרה מבוססת רק על הוצאות בפועל
2. **ניתוח סטיות**: הבנה ברורה של חריגות מהתכנון
3. **תכנון טוב יותר**: למידה מסטיות עבר לשיפור תכנונים עתידיים
4. **גמישות**: תכנונים לא "נועלים" תקציב שעלול להשתחרר

## אינדיקטורים

### צבעי סטייה:
- 🟢 **ירוק (0-90%)**: חיסכון - הוצאת פחות מהתכנון
- 🟡 **צהוב (90-110%)**: קרוב - ביצוע קרוב לתכנון
- 🔴 **אדום (110%+)**: חריגה - הוצאת יותר מהתכנון

## דוגמה מעשית

### תרחיש: קרן "אירועים"

**הקצאה חודשית**: 5,000 ₪

**תכנון**:
- אירוע גדול: 3,000 ₪
- אירוע קטן: 1,000 ₪
- **סה"כ מתוכנן**: 4,000 ₪
- **לא מתוכנן**: 1,000 ₪

**ביצוע בפועל**:
- אירוע גדול עלה: 3,500 ₪ (חריגה של 500 ₪)
- אירוע קטן בוטל: 0 ₪
- הוצאה לא מתוכננת: 800 ₪
- **סה"כ הוצא**: 4,300 ₪
- **נשאר**: 700 ₪

**ניתוח סטיות**:
- תוכנן: 4,000 ₪
- בוצע: 4,300 ₪
- סטייה: +300 ₪ (107.5%)
- אינדיקטור: 🟡 קרוב לתכנון

**תובנות**:
- למרות שהאירוע הגדול עלה יותר, ביטול האירוע הקטן איזן חלקית
- יש עדיין 700 ₪ זמינים לשימוש (לא 0 ₪ כמו בגישה הישנה)
- בתכנון הבא, כדאי להוסיף buffer גדול יותר לאירועים גדולים

## שינויים טכניים

### Backend API Response
```json
{
  "allocated": 100,
  "actual": {
    "spent": 70,
    "remaining": 30
  },
  "planning": {
    "planned": 50,
    "unplanned": 50
  },
  "variance": {
    "planned": 50,
    "actual": 70,
    "difference": 20,
    "percentage": 140
  }
}
```

### Frontend Components
- **FundMonthlyDetail**: שלוש טבלאות נפרדות
- **MonthlyFundStatusCard**: כרטיס עם ביצוע וסטייה
- **MonthlyFundStatus Type**: מבנה נתונים מעודכן

## מסקנות

ההפרדה בין תכנון לביצוע מאפשרת:
- ✅ ניהול תקציב מדויק יותר
- ✅ הבנה טובה יותר של דפוסי הוצאה
- ✅ שיפור מתמיד של תכנונים
- ✅ גמישות בניהול תקציבי

---

**תאריך עדכון**: אוקטובר 2025
