# שינוי הרשאות - הכנסות צפויות לחברים

## סיכום השינוי

כעת כל חבר יכול להוסיף, לערוך ולמחוק הכנסות צפויות **על עצמו בלבד**.

## מה השתנה?

### לפני השינוי
- רק גזבר מעגל יכול היה להוסיף הכנסות צפויות
- חברים רגילים לא יכלו לתכנן את ההכנסות שלהם

### אחרי השינוי
- **חברים רגילים** יכולים להוסיף הכנסות צפויות חודשיות על עצמם
- חברים יכולים לערוך ולמחוק הכנסות צפויות שהם יצרו
- **גזבר מעגל** עדיין יכול להוסיף הכנסות צפויות על כל חבר
- תכנון שנתי (annual planning) נשאר זמין רק לגזבר מעגל

## הגבלות לחברים רגילים

1. **רק על עצמם**: חבר יכול להוסיף הכנסה צפויה רק כאשר הוא המקור
2. **רק חודשי**: חברים יכולים להוסיף רק הכנסות צפויות חודשיות (לא תכנון שנתי)
3. **עריכה ומחיקה**: חבר יכול לערוך/למחוק רק הכנסות צפויות שהוא יצר

## שינויים טכניים

### Backend
- **Routes** (`backend/src/routes/expectedIncomeRoutes.ts`):
  - הוסר `requireTreasurer` מ-`POST /monthly`
  - הוסר `requireTreasurer` מ-`PATCH /:id`
  - הוסר `requireTreasurer` מ-`DELETE /:id`
  - הוסר `requireTreasurer` מ-`POST /:id/categories`

- **Controller** (`backend/src/controllers/expectedIncomeController.ts`):
  - `createMonthlyExpectedIncome`: בדיקה שחבר רגיל יכול להוסיף רק על עצמו
  - `updateExpectedIncome`: בדיקה שחבר יכול לעדכן רק הכנסות צפויות שלו
  - `deleteExpectedIncome`: בדיקה שחבר יכול למחוק רק הכנסות צפויות שלו
  - `assignCategories`: בדיקה שחבר יכול לשייך קטגוריות רק להכנסות צפויות שלו

### Frontend
- **Incomes Page** (`frontend/src/pages/Incomes.tsx`):
  - הכפתור "הוסף הכנסה צפויה לחודש זה" זמין לכל חבר (לא רק לגזבר)
  - בדיקת הרשאות בעריכה ומחיקה של הכנסות צפויות

- **Expected Income Form Modal** (`frontend/src/components/ExpectedIncomeFormModal.tsx`):
  - חברים רגילים רואים רק את עצמם ברשימת המקורות
  - השדה נעול (disabled) לחברים רגילים
  - הודעה מידעתית: "ניתן להוסיף הכנסה צפויה רק על עצמך"
  - ברירת מחדל: המשתמש הנוכחי נבחר אוטומטית

## דוגמאות שימוש

### חבר רגיל
```
1. נכנס לעמוד "הכנסות"
2. לוחץ על "הוסף הכנסה צפויה לחודש זה"
3. רואה רק את עצמו כמקור (השדה נעול)
4. ממלא סכום, תיאור, קטגוריות
5. שומר - ההכנסה הצפויה נוצרת על שמו
```

### גזבר מעגל
```
1. נכנס לעמוד "הכנסות"
2. לוחץ על "הוסף הכנסה צפויה לחודש זה"
3. יכול לבחור כל חבר מהרשימה
4. יכול גם להוסיף "מקור אחר"
5. שומר - ההכנסה הצפויה נוצרת על החבר שנבחר
```

## בדיקות מומלצות

1. ✅ חבר רגיל יכול להוסיף הכנסה צפויה על עצמו
2. ✅ חבר רגיל לא יכול להוסיף הכנסה צפויה על חבר אחר
3. ✅ חבר רגיל יכול לערוך הכנסה צפויה שהוא יצר
4. ✅ חבר רגיל לא יכול לערוך הכנסה צפויה של חבר אחר
5. ✅ חבר רגיל יכול למחוק הכנסה צפויה שהוא יצר
6. ✅ חבר רגיל לא יכול למחוק הכנסה צפויה של חבר אחר
7. ✅ גזבר מעגל יכול להוסיף/לערוך/למחוק כל הכנסה צפויה
8. ✅ תכנון שנתי זמין רק לגזבר מעגל

## הערות

- השינוי לא משפיע על הכנסות בפועל (actual incomes) - רק גזבר יכול להוסיף אותן
- השינוי לא משפיע על תכנון שנתי - רק גזבר יכול ליצור תכנון שנתי
- השינוי מאפשר לחברים לתכנן את ההכנסות שלהם באופן עצמאי
