# מסמך דרישות - שיפור מעקב הכנסות

## מבוא

מערכת מעקב ההכנסות הקיימת במערכת הניהול התקציבי מוגבלת ואינה מספקת לגזברית המעגל כלים מספיקים למעקב ותכנון הכנסות. תכונה זו תרחיב את יכולות מעקב ההכנסות כך שתאפשר לגזברית:

- לעקוב אחר הכנסות מחברים ומקורות אחרים
- לתכנן הכנסות צפויות ברמה חודשית ושנתית
- להשוות בין הכנסות צפויות להכנסות בפועל
- לקטלג הכנסות לפי קטגוריות מותאמות אישית
- לקבל תמונה ברורה של מצב ההכנסות בכל זמן נתון

המערכת תשמש בעיקר את גזברית המעגל, אך תספק גם שקיפות לחברים לגבי ההכנסות שלהם.

## דרישות

### דרישה 1: רישום הכנסות בפועל

**User Story:** כגזברית מעגל, אני רוצה לרשום הכנסות שהתקבלו בפועל, כך שאוכל לעקוב אחר כל ההכנסות שנכנסו למעגל.

#### קריטריוני קבלה

1. WHEN הגזברית ניגשת לדף רישום הכנסה חדשה THEN המערכת SHALL להציג טופס עם השדות הבאים:
   - סכום ההכנסה (חובה, מספר חיובי)
   - תאריך ההכנסה (חובה, תאריך)
   - תיאור ההכנסה (חובה, טקסט חופשי)
   - מקור ההכנסה: חבר ספציפי או "מקור אחר" (חובה)
   - IF מקור ההכנסה הוא חבר THEN בחירת חבר מרשימה (חובה)
   - קטגוריות (אופציונלי, בחירה מרובה מרשימת קטגוריות קיימות)

2. WHEN הגזברית שומרת הכנסה חדשה THEN המערכת SHALL לשמור את ההכנסה במסד הנתונים עם כל הפרטים שהוזנו

3. WHEN הגזברית שומרת הכנסה חדשה THEN המערכת SHALL להציג הודעת הצלחה ולנקות את הטופס

4. WHEN הגזברית מזינה סכום שלילי או אפס THEN המערכת SHALL להציג הודעת שגיאה ולמנוע שמירה

5. WHEN הגזברית מזינה תאריך עתידי THEN המערכת SHALL לאפשר שמירה (הכנסה עתידית מתוכננת)

### דרישה 2: צפייה ועריכת הכנסות קיימות

**User Story:** כגזברית מעגל, אני רוצה לראות את כל ההכנסות שנרשמו ולערוך אותן במידת הצורך, כך שאוכל לתקן טעויות ולעדכן מידע.

#### קריטריוני קבלה

1. WHEN הגזברית ניגשת לדף ההכנסות THEN המערכת SHALL להציג טבלה עם כל ההכנסות הקיימות

2. WHEN מוצגת טבלת ההכנסות THEN המערכת SHALL להציג את העמודות הבאות:
   - תאריך ההכנסה
   - מקור ההכנסה (שם חבר או שם מקור אחר)
   - תיאור
   - סכום
   - קטגוריות (רשימה)
   - סטטוס (בפועל/צפויה)
   - פעולות (עריכה, מחיקה)

3. WHEN הגזברית לוחצת על כפתור עריכה של הכנסה THEN המערכת SHALL לפתוח טופס עריכה עם כל הפרטים הקיימים

4. WHEN הגזברית משנה פרטי הכנסה ושומרת THEN המערכת SHALL לעדכן את ההכנסה במסד הנתונים

5. WHEN הגזברית לוחצת על כפתור מחיקה THEN המערכת SHALL להציג אישור מחיקה

6. WHEN הגזברית מאשרת מחיקה THEN המערכת SHALL למחוק את ההכנסה ולהסיר אותה מהטבלה

7. WHEN הטבלה מכילה הכנסות רבות THEN המערכת SHALL לאפשר מיון לפי כל עמודה (תאריך, סכום, מקור)

8. WHEN הטבלה מכילה הכנסות רבות THEN המערכת SHALL לאפשר סינון לפי:
   - טווח תאריכים
   - מקור הכנסה (חבר ספציפי או מקור אחר)
   - קטגוריה
   - סטטוס (בפועל/צפויה)

### דרישה 3: ניהול קטגוריות הכנסות

**User Story:** כגזברית מעגל, אני רוצה ליצור ולנהל קטגוריות להכנסות, כך שאוכל לארגן ולנתח הכנסות לפי סוגים שונים.

#### קריטריוני קבלה

1. WHEN הגזברית ניגשת לדף ניהול קטגוריות הכנסות THEN המערכת SHALL להציג רשימה של כל הקטגוריות הקיימות

2. WHEN הגזברית לוחצת על "הוסף קטגוריה חדשה" THEN המערכת SHALL לפתוח טופס עם השדות:
   - שם הקטגוריה (חובה, טקסט ייחודי)
   - תיאור הקטגוריה (אופציונלי)
   - צבע לזיהוי ויזואלי (אופציונלי)

3. WHEN הגזברית שומרת קטגוריה חדשה THEN המערכת SHALL לשמור את הקטגוריה ולהוסיף אותה לרשימת הקטגוריות הזמינות

4. WHEN הגזברית מנסה ליצור קטגוריה עם שם קיים THEN המערכת SHALL להציג הודעת שגיאה ולמנוע יצירה כפולה

5. WHEN הגזברית לוחצת על עריכת קטגוריה THEN המערכת SHALL לאפשר עריכת שם, תיאור וצבע

6. WHEN הגזברית לוחצת על מחיקת קטגוריה THEN המערכת SHALL לבדוק אם יש הכנסות המשויכות לקטגוריה זו

7. WHEN קטגוריה משויכת להכנסות קיימות AND הגזברית מנסה למחוק אותה THEN המערכת SHALL להציג אזהרה עם מספר ההכנסות המשויכות

8. WHEN הגזברית מאשרת מחיקת קטגוריה המשויכת להכנסות THEN המערכת SHALL למחוק את הקטגוריה ולהסיר את השיוך מההכנסות (ההכנסות יישארו ללא קטגוריה זו)

9. WHEN הגזברית מאשרת מחיקת קטגוריה שאינה משויכת להכנסות THEN המערכת SHALL למחוק את הקטגוריה מיידית

### דרישה 4: תכנון הכנסות צפויות - רמה שנתית

**User Story:** כגזברית מעגל, אני רוצה לתכנן הכנסות צפויות לשנה הקרובה, כך שאוכל לבנות תקציב מבוסס על הכנסות מתוכננות.

#### קריטריוני קבלה

1. WHEN הגזברית ניגשת לדף תכנון הכנסות שנתי THEN המערכת SHALL להציג טופס תכנון שנתי

2. WHEN הגזברית בוחרת שנה לתכנון THEN המערכת SHALL להציג את התכנון הקיים לאותה שנה (אם קיים)

3. WHEN הגזברית מוסיפה הכנסה צפויה שנתית THEN המערכת SHALL לאפשר הזנת:
   - מקור ההכנסה (חבר או מקור אחר)
   - סכום שנתי כולל
   - תיאור
   - קטגוריות
   - תדירות: חד-פעמי או חוזר (חודשי/רבעוני/שנתי)

4. WHEN הכנסה מוגדרת כחוזרת חודשית THEN המערכת SHALL לחלק את הסכום השנתי ל-12 חודשים באופן אוטומטי

5. WHEN הכנסה מוגדרת כחוזרת רבעונית THEN המערכת SHALL לחלק את הסכום השנתי ל-4 רבעונים באופן אוטומטי

6. WHEN הכנסה מוגדרת כחד-פעמית THEN המערכת SHALL לבקש בחירת חודש ספציפי לתכנון

7. WHEN הגזברית שומרת תכנון שנתי THEN המערכת SHALL לשמור את התכנון ולעדכן את התצוגה החודשית בהתאם

### דרישה 5: תכנון הכנסות צפויות - רמה חודשית

**User Story:** כגזברית מעגל, אני רוצה לתכנן ולערוך הכנסות צפויות ברמה חודשית, כך שאוכל להתאים את התכנון למציאות המשתנה.

#### קריטריוני קבלה

1. WHEN הגזברית ניגשת לדף תכנון הכנסות חודשי THEN המערכת SHALL להציג ניווט חודשים (דומה לניווט בעמוד מעקב תקציב חודשי)

2. WHEN הגזברית בוחרת חודש ושנה THEN המערכת SHALL להציג את כל ההכנסות הצפויות לאותו חודש

3. WHEN מוצגות הכנסות צפויות לחודש THEN המערכת SHALL להבחין בין:
   - הכנסות שנוצרו מתכנון שנתי (מסומנות כ"אוטומטי")
   - הכנסות שנוספו ידנית לחודש הספציפי (מסומנות כ"ידני")

4. WHEN הגזברית לוחצת על "הוסף הכנסה צפויה" THEN המערכת SHALL לאפשר הוספת הכנסה צפויה ספציפית לחודש הנבחר

5. WHEN הכנסה צפויה נוצרה מתכנון שנתי THEN המערכת SHALL לאפשר עריכת הסכום רק לחודש הספציפי (ללא שינוי התכנון השנתי)

6. WHEN הכנסה צפויה נוצרה ידנית THEN המערכת SHALL לאפשר עריכה ומחיקה מלאה

7. WHEN הגזברית משנה סכום הכנסה שנוצרה מתכנון שנתי THEN המערכת SHALL לשמור את השינוי רק לחודש הנוכחי ולסמן "שונה מתכנון שנתי"

8. WHEN הגזברית מוחקת הכנסה שנוצרה מתכנון שנתי THEN המערכת SHALL להציג אזהרה שהמחיקה תשפיע רק על החודש הנוכחי

### דרישה 6: השוואה בין הכנסות צפויות לבפועל

**User Story:** כגזברית מעגל, אני רוצה לראות השוואה בין ההכנסות שתכננתי להכנסות שהתקבלו בפועל, כך שאוכל להבין את הפערים ולשפר את התכנון.

#### קריטריוני קבלה

1. WHEN הגזברית ניגשת לדף דשבורד הכנסות THEN המערכת SHALL להציג סיכום חודשי עם:
   - סך הכנסות צפויות לחודש הנוכחי
   - סך הכנסות בפועל לחודש הנוכחי
   - פער (הפרש בין צפוי לבפועל)
   - אחוז התממשות (בפועל / צפוי × 100)

2. WHEN מוצג פירוט חודשי THEN המערכת SHALL להציג טבלה עם:
   - מקור ההכנסה
   - סכום צפוי
   - סכום בפועל
   - פער
   - סטטוס (התקבל במלואו / התקבל חלקית / לא התקבל / התקבל יותר מהצפוי)

3. WHEN הגזברית מסננת לפי קטגוריה THEN המערכת SHALL להציג השוואה רק עבור הכנסות מהקטגוריה הנבחרת

4. WHEN הגזברית מסננת לפי מקור הכנסה THEN המערכת SHALL להציג השוואה רק עבור המקור הנבחר

5. WHEN הכנסה צפויה לא התקבלה בפועל THEN המערכת SHALL לסמן אותה בצבע אדום בטבלת ההשוואה

6. WHEN הכנסה בפועל גבוהה מהצפוי THEN המערכת SHALL לסמן אותה בצבע ירוק בטבלת ההשוואה

7. WHEN הכנסה בפועל נמוכה מהצפוי THEN המערכת SHALL לסמן אותה בצבע כתום בטבלת ההשוואה

### דרישה 7: הרשאות וגישה

**User Story:** כמשתמש במערכת, אני רוצה שההרשאות למעקב הכנסות יהיו מוגדרות בצורה ברורה, כך שרק משתמשים מורשים יוכלו לצפות ולערוך מידע רגיש.

#### קריטריוני קבלה

1. WHEN משתמש עם תפקיד "גזברית מעגל" ניגש לדפי הכנסות THEN המערכת SHALL לאפשר גישה מלאה (צפייה, עריכה, מחיקה, תכנון)

2. WHEN משתמש עם תפקיד "גזברית קבוצה" ניגש לדפי הכנסות THEN המערכת SHALL לאפשר צפייה בלבד בהכנסות ברמת המעגל

3. WHEN משתמש עם תפקיד "חבר מעגל" או "חבר קבוצה" ניגש לדפי הכנסות THEN המערכת SHALL להציג רק הכנסות שמקורן החבר עצמו

4. WHEN חבר מציג את ההכנסות שלו THEN המערכת SHALL להציג:
   - הכנסות בפועל שנרשמו עבורו
   - הכנסות צפויות שתוכננו עבורו
   - סטטוס תשלום (שולם/טרם שולם)

5. WHEN משתמש לא מורשה מנסה לגשת לדפי ניהול הכנסות THEN המערכת SHALL להציג הודעת שגיאה "אין לך הרשאה לצפות בדף זה"

6. WHEN משתמש לא מורשה מנסה לבצע פעולת עריכה או מחיקה THEN המערכת SHALL לחסום את הפעולה ולהציג הודעת שגיאה

### דרישה 8: ממשק משתמש בעברית וחוויית משתמש

**User Story:** כמשתמש במערכת, אני רוצה שממשק מעקב ההכנסות יהיה בעברית וידידותי, כך שאוכל להשתמש בו בקלות.

#### קריטריוני קבלה

1. WHEN מוצג כל דף במערכת מעקב ההכנסות THEN המערכת SHALL להציג את כל הטקסטים בעברית

2. WHEN מוצגות טבלאות THEN המערכת SHALL להציג אותן בפריסה RTL (מימין לשמאל)

3. WHEN מוצגים תאריכים THEN המערכת SHALL להציג אותם בפורמט עברי (DD/MM/YYYY)

4. WHEN מוצגים סכומים THEN המערכת SHALL להציג אותם עם פסיק כמפריד אלפים (לדוגמה: 1,500 ₪)

5. WHEN הגזברית מבצעת פעולה THEN המערכת SHALL להציג הודעות משוב בעברית (הצלחה/שגיאה)

6. WHEN מוצגים גרפים THEN המערכת SHALL להציג תוויות ומקרא בעברית

7. WHEN הגזברית מרחפת מעל אלמנט אינטראקטיבי THEN המערכת SHALL להציג tooltip הסבר בעברית

8. WHEN מוצג טופס עם שדות חובה THEN המערכת SHALL לסמן אותם בבירור (כוכבית אדומה)

9. WHEN הגזברית מזינה נתונים לא תקינים THEN המערכת SHALL להציג הודעת שגיאה ברורה בעברית מתחת לשדה הרלוונטי

10. WHEN מוצגת טבלה ארוכה THEN המערכת SHALL לכלול pagination או גלילה אינסופית לשיפור הביצועים
